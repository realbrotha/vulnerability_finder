//
// Created by realbro on 10/5/20.
//

#include "FindStringFromFile.h"

#include <sstream>
#include <vector>
#include <fstream>
#include <unistd.h>
FindStringFromFile::FindStringFromFile() {

}

bool FindStringFromFile::Scan(const std::string &param, AfterWork condition) {
  bool result = false;
  // TODO : 방어코드

  std::vector<std::string> split_result;
  std::string token;
  std::stringstream ss(param);

  while (getline(ss, token, ' ')) {
    split_result.push_back(token);
  }

  std::string file_path = split_result[0];
  std::string tango_string = split_result[1];

  if( access( file_path.c_str(), F_OK ) != -1 ) {
    std::ifstream open_file(file_path);
    if (open_file.is_open()) {
      std::string line;
      while (getline(open_file, line)) {
        if (line.find(tango_string) != std::string::npos) {
          //printf ("Find!!!\n");
          result = true; // HACK : Find.
        }
      }
    }
  }
  return result;
}