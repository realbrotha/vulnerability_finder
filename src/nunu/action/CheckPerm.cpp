//
// Created by realbro on 10/20/20.
//

#include "CheckPerm.h"

#include <string>
#include <sstream>
#include <vector>
#include <fstream>
#include <unistd.h>
#include <sys/stat.h>

CheckPerm::CheckPerm() {

}

bool CheckPerm::Scan(const std::string &param, AfterWork condition) {
  // TODO : 방어코드
  bool result = false;

  std::vector<std::string> split_result;
  std::string token;
  std::stringstream ss(param);

  while (getline(ss, token, ' ')) {
    split_result.push_back(token);
  }

  std::string file_path = split_result[0];
  std::string permission_string = split_result[1];

  unsigned int num = std::stoi (permission_string, 0, 8);
  struct stat st = {0,};
  if( access( file_path.c_str(), F_OK ) != -1 ) {
    if(stat(file_path.c_str(), &st) != -1) {
      if (num == (st.st_mode & 0x00000FFF)) {
        result =true;
      }
    }

  }

  return result;
}

